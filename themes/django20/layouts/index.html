{{- define "main" -}}

<section>
  <div class="container container-main {{ .Params.cssClassSuffix }}">
    <article class="{{ .Params.cssClassSuffix }}">
      {{ .Content }}
    </article>
  </div>
</section>

{{ $events := (where (.Site.GetPage "/events").Pages.ByDate "published" "!=" "false") }}

<section class="map" id="events">
  <div class="container">
    <article>
      <h1>Explore Events Across Our Global Community!</h1>
    </article>
  </div>
  {{ partial "events_map.html" (dict "events" $events "context" .) }}
</section>

<section class="events" id="events">

    {{ $today := now.UTC.Format "2006-01-02" }}
    <div class="table event-dropdown">
      <input type="checkbox" id="toggle-upcoming" checked hidden>
      <!-- Upcoming Events -->
      <section class="table__header">
        <label class="event-toggle" for="toggle-upcoming">
          <h2>Upcoming Events</h2>
          <svg class="arrow-icon-upcoming" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none"
              viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M19 9l-7 7-7-7" />
          </svg>
        </label>
      </section>
      <section class="table__body dropdown-content">
      <div class="scroll-container">
        <table class="event-table" id="upcoming-table">
          <thead>
            <tr class="table-header">
              <th class="date header-element">Event</th>
              <th class="header-element">Location</th>
              <th class="header-element">Date</th>
              <th class="header-element">Category</th>
              <th class="header-element">Host</th>
            </tr>
	    <tr class="search-row">
              <th><input type="text" placeholder="ðŸ” Search Event"></th>
              <th><input type="text" placeholder="ðŸ” Search Location"></th>
              <th><input type="text" placeholder="ðŸ” Search Date"></th>
              <th><input type="text" placeholder="ðŸ” Search Category"></th>
              <th><input type="text" placeholder="ðŸ” Search Host"></th>
            </tr>
          </thead>
          <tbody>
            {{ $upcoming := sort (where $events ".Params.event_date" "ge" $today) ".Params.event_date" "asc" }}
            {{ if gt (len $upcoming) 0 }}
              {{ range $upcoming }}
              <tr>
                <!-- Event -->
                <td class="event-link">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10 13a5 5 0 0 1 0-7l1.5-1.5a5 5 0 0 1 7 7L17 13" />
                    <path d="M14 11a5 5 0 0 1 0 7l-1.5 1.5a5 5 0 0 1-7-7L7 11" />
                  </svg>
                  <a href="{{ .Params.event_url | default .Permalink }}" target="_blank">{{ .Title | truncate 50 }}</a>
                </td>

                <!-- Location -->
                <td>
                  {{ $city := .Params.city }}
                  {{ $country := .Params.country }}
                  {{ if and $city (not (findRE "[0-9]" $city)) }}{{ $city }}{{ if $country }}, {{ end }}{{ end }}
                  {{ if $country }}{{ $country }}{{ end }}
                </td>

                <!-- Date -->
                <td>
                  {{ $eventDate := .Params.event_date | time }}
                  <span>{{ $eventDate.Format "02 January" }}</span>
                  {{ if and .Params.event_date_end (ne .Params.event_date_end .Params.event_date) }}
                    &nbsp;&raquo;&nbsp;
                    {{ $eventDateEnd := .Params.event_date_end | time }}
                    <span>{{ $eventDateEnd.Format "02 January" }}</span>
                  {{ end }}
                </td>

                <!-- Category -->
                <td>
                  <p class="event-category {{ .Params.event_category }}">
                    {{ with .Params.event_category }}{{ . }}{{ else }}â€”{{ end }}
                  </p>
                </td>

                <!-- Host -->
                <td>{{ .Params.event_host }}</td>
              </tr>
              {{ end }}
            {{ else }}
              <tr class="no-data">
                <td colspan="5">No upcoming events available.</td>
              </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
    </section>
  </div>

    <div class="table event-dropdown">
      <input type="checkbox" id="toggle-past" hidden>
      <!-- Past events -->
      <section class="table__header">
        <label class="event-toggle" for="toggle-past">
          <h2>Past Events</h2>
          <svg class="arrow-icon-past" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none"
            viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M19 9l-7 7-7-7" />
          </svg>
        </label>
      </section>
      <section class="table__body dropdown-content">
      <div class="scroll-container">
        <table class="event-table" id="past-table">
          <thead>
            <tr class="table-header">
              <th class="date header-element">Event</th>
              <th class="header-element">Location</th>
              <th class="header-element">Date</th>
              <th class="header-element">Category</th>
              <th class="header-element">Host</th>
            </tr>
	    <tr class="search-row">
              <th><input type="text" placeholder="ðŸ” Search Event"></th>
              <th><input type="text" placeholder="ðŸ” Search Location"></th>
              <th><input type="text" placeholder="ðŸ” Search Date"></th>
              <th><input type="text" placeholder="ðŸ” Search Category"></th>
              <th><input type="text" placeholder="ðŸ” Search Host"></th>
            </tr>
          </thead>
          <tbody>
            {{ $past := sort (where $events ".Params.event_date" "lt" $today) ".Params.event_date" "desc" }}
            {{ if gt (len $past) 0 }}
              {{ range $past }}
              <tr>
                <td class="event-link">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10 13a5 5 0 0 1 0-7l1.5-1.5a5 5 0 0 1 7 7L17 13" />
                    <path d="M14 11a5 5 0 0 1 0 7l-1.5 1.5a5 5 0 0 1-7-7L7 11" />
                  </svg>
                  <a href="{{ .Params.event_url | default .Permalink }}" target="_blank">{{ .Title | truncate 50 }}</a>
                </td>

                <td>
                  {{ $city := .Params.city }}
                  {{ $country := .Params.country }}
                  {{ if and $city (not (findRE "[0-9]" $city)) }}{{ $city }}{{ if $country }}, {{ end }}{{ end }}
                  {{ if $country }}{{ $country }}{{ end }}
                </td>

                <td>
                  {{ $eventDate := .Params.event_date | time }}
                  <span>{{ $eventDate.Format "02 January" }}</span>
                  {{ if and .Params.event_date_end (ne .Params.event_date_end .Params.event_date) }}
                    &nbsp;&raquo;&nbsp;
                    {{ $eventDateEnd := .Params.event_date_end | time }}
                    <span>{{ $eventDateEnd.Format "02 January" }}</span>
                  {{ end }}
                </td>

                <td>
                  <p class="event-category {{ .Params.event_category }}">
                    {{ with .Params.event_category }}{{ . }}{{ else }}â€”{{ end }}
                  </p>
                </td>

                <td>{{ .Params.event_host }}</td>
              </tr>
              {{ end }}
            {{ else }}
              <tr class="no-data">
                <td colspan="5">No past events available.</td>
              </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
    </section>
  </div>
</section>

<!--  JS for Column Filtering -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  function setupTableFilter(tableId) {
    const table = document.getElementById(tableId);
    const filters = table.querySelectorAll('.search-row input');
    const rows = table.querySelectorAll('tbody tr:not(.no-data)');

    filters.forEach((input, colIndex) => {
      input.addEventListener('keyup', function () {
        const filterValue = input.value.toLowerCase();
        let visibleCount = 0;
        rows.forEach(row => {
          const cell = row.cells[colIndex];
          const text = cell ? cell.textContent.toLowerCase() : "";
          if (text.includes(filterValue)) {
            row.style.display = "";
            visibleCount++;
          } else {
            row.style.display = "none";
          }
        });

        const noDataRow = table.querySelector('.no-data');
        if (noDataRow) {
          noDataRow.style.display = visibleCount === 0 ? "" : "none";
        }
      });
    });
  }

  setupTableFilter('upcoming-table');
  setupTableFilter('past-table');
});
</script>


{{- end -}}
